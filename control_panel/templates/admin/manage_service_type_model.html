{% extends "../index.html" %}
{% block title %} Users {% endblock %}
{% block content %}

<style>
  .circle-btn {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background-color: blue;
    color: white;
    border: none;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    cursor: pointer;
    box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
    transition: background-color 0.3s ease;
    position: fixed;
    bottom: 20px;
    right: 20px;
  }

  .circle-btn:hover {
    background-color: darkblue;
  }

  /* Modal Width */
  @media (min-width: 1200px) {
    .modal-dialog {
      max-width: 90%;
      /* Adjust width */
    }
  }

  /* Modal Header */
  .modal-header {
    background-color: #cecfd1;
    color: white;
    border-bottom: 2px solid #c0c0c0;
    padding: 15px;
  }

  .modal-title {
    flex-grow: 1;
    text-align: center;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const editButtons = document.querySelectorAll('.edit-btn');
    const addButton = document.querySelector('.circle-btn');
    const form = document.getElementById('addUserForm');
    const modalLabel = document.getElementById('addUserModalLabel');
    // ADD: Reset form
    addButton.addEventListener('click', function () {
      form.reset();
      modalLabel.textContent = "Add Service";
      form.action = "{% url 'manage_service_type_model_create' %}";
    });

    // EDIT: Fill form with existing values
    editButtons.forEach(btn => {
      btn.addEventListener('click', function () {
        modalLabel.textContent = "Edit Service";
        form.action = this.getAttribute('data-action-url');
        form.elements['service_name'].value = this.getAttribute('data-service-name');
        new bootstrap.Modal(document.getElementById('addUserModal')).show();
      });
    });
  });

</script>

<div class="container-fluid">

  <h1 class="h3 mb-2 text-gray-800">Service Type
  </h1>
  <p class="mb-4">Manage service type in the system.</p>

  <!-- Add Button (Opens Modal) -->
  <button class="circle-btn" data-bs-toggle="modal" data-bs-target="#addUserModal">
    <i class="bi bi-plus-lg text-light"></i>
  </button>

  <!-- Bootstrap Modal -->
  <div class="modal fade" id="addUserModal" tabindex="-1" aria-labelledby="addUserModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title fw-bold" id="addUserModalLabel">Add User</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="addUserForm" method="POST" action="{% url 'manage_service_type_model_create' %}" class="fw-bold">
            {% csrf_token %}
            <div class="row">
              <div class="form-group col-md-12 mb-3" name="service_name">
                {{ form.service_name.label_tag }}<span class="text-danger">*</span>
                {{ form.service_name }}
              </div>
            </div>
            <div class="modal-footer">
              <button type="submit" class="btn btn-primary">Save</button>
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- User Table -->
  <div class="card shadow mb-4">
    <div class="card-header py-3">
      <h6 class="m-0 font-weight-bold text-primary">Users</h6>
    </div>
    <div class="card-body">
  <div class="table-responsive">
    <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
      <thead>
        <tr>
          <th>Service Name</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for data in services %}
        <tr data-id="{{ data.id }}">
          <td>{{ data.service_name }}</td>
          <td>
            <a href="#" class="text-primary edit-btn"
               data-id="{{ data.id }}"
               data-service-name="{{ data.service_name }}"
               data-action-url="{% url 'manage_service_type_model_update' data.id %}">
              <i class="bi bi-pencil-square"></i>
            </a>

            {% if data.id %}
            <form method="post" action="{% url 'manage_service_type_model_delete' data.id %}" style="display:inline;">
              {% csrf_token %}
              <button type="submit" class="btn text-danger btn-sm"
                      onclick="return confirm('Are you sure you want to delete this user?');">
                <i class="bi bi-trash"></i>
              </button>
            </form>
            {% else %}
            <button class="btn btn-danger btn-sm" disabled>
              <i class="bi bi-trash"></i>
            </button>
            {% endif %}

            <form method="post" action="{% url 'manage_toggle_service_type_active' data.id %}" style="display:inline;">
              {% csrf_token %}
              <button type="submit"
                      class="btn btn-sm {% if data.is_active %}text-success{% else %}text-muted{% endif %}"
                      title="Toggle visibility"
                      onclick="return confirm('Are you sure you want to toggle this user\'s visibility?');">
                {% if data.is_active %}
                <i class="bi bi-eye text-primary fs-6"></i>
                {% else %}
                <i class="bi bi-eye-slash text-danger fs-6"></i>
                {% endif %}
              </button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

  </div>
</div>

<script>
  $(document).ready(function () {
    $("#addUserForm").validate({
      rules: {
    service_name: {
      required: true,
      minlength: 2,
      pattern: /^[a-zA-Z0-9\s]+$/   // allow only letters, numbers, and space
    }
  },
  messages: {
    service_name: {
      required: "Please enter the service name",
      minlength: "Must be at least 2 characters long",
      pattern: "Only letters, numbers, and spaces are allowed"
    }
  },
      errorElement: "div",
      errorClass: "text-danger",
      highlight: function (element) {
        $(element).addClass("is-invalid");
      },
      unhighlight: function (element) {
        $(element).removeClass("is-invalid");
      }
    });
  });
</script>
  

{% endblock %}
{% extends "../index.html" %}
{% block title %} Users {% endblock %}
{% block content %}
{% load static %}

<style>
    .modal-header {
        background-color: #007bff;
        color: white;
        border-top-left-radius: 5px;
        border-top-right-radius: 5px;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .modal-title {
        font-weight: bold;
        flex-grow: 1;
        text-align: center;
    }

    .circle-btn {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background-color: blue;
        color: white;
        border: none;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        cursor: pointer;
        position: fixed;
        bottom: 20px;
        right: 20px;
    }

    .circle-btn:hover {
        background-color: darkblue;
    }


    /*Modal Widht*/
    @media (min-width: 1200px) {
        .modal-dialog {
            max-width: 90%; /* Adjust width */
        }
    }

    /* Modal Header */
    .modal-header {
        background-color: #cecfd1;
        color: white;
        border-bottom: 2px solid #c0c0c0;
        padding: 15px;
    }

    .modal-title {
        flex-grow: 1;
        text-align: center;
    }
</style>



<script>
    document.addEventListener('DOMContentLoaded', function () {
        document.querySelectorAll('.edit-user-btn').forEach(button => {
            button.addEventListener('click', function () {
                const userId = this.dataset.id;

                fetch(`/get-user/${userId}/`)
                    .then(response => response.json())
                    .then(data => {
                        // Fill the form
                        for (const field in data) {
                            const input = document.querySelector(`#addUserForm [name="${field}"]`);
                            if (input) {
                                input.value = data[field];
                            }
                        }

                        // Update form action to point to update route
                        document.querySelector('#addUserForm').action = `/update-user/${userId}/`;

                        // Show the modal
                        const modal = new bootstrap.Modal(document.getElementById('addUserModal'));
                        modal.show();
                    });
            });
        });
    });
</script>


<!-- Begin Page Content -->
<div class="container-fluid">

    <!-- Page Heading -->
    <h1 class="h3 mb-2 text-gray-800">Tables</h1>
    <p class="mb-4">DataTables is a third party plugin that is used to generate the demo table below.
        For more information about DataTables, please visit the <a target="_blank"
            href="https://datatables.net">official DataTables documentation</a>.</p>

    <!-- Bootstrap Modal -->
     <!-- user create -->
    <div class="modal fade" id="addUserModal" tabindex="-1" aria-labelledby="addUserModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addUserModalLabel">Add User</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Django Form -->
                    <form id="addUserForm" method="post">
                        {% csrf_token %}
                        <div class="row">
                            <div class="form-group col-md-4 mb-3">{{ form.first_name.label_tag }} {{ form.first_name }}</div>
                            <div class="form-group col-md-4 mb-3">{{ form.last_name.label_tag }} {{ form.last_name }}</div>
                            <div class="form-group col-md-4 mb-3">{{ form.email.label_tag }} {{ form.email }}</div>
                        </div>
                        <div class="row">
                            <div class="form-group col-md-4 mb-3">{{ form.dob.label_tag }} {{ form.dob }}</div>
                            <div class="form-group col-md-4 mb-3">{{ form.gender.label_tag }} 
                                <select id="gender" name="gender" class="form-select">
                                    <!-- Default "None" option -->
                                    <option value="" selected>Select Gender</option>
                                    {% for gender in choices_gender %}
                                        {% for name, value in gender.items %}
                                            <option value="{{ name }}" {% if user.gender == name %}selected{% endif %}>{{ value }}</option>
                                        {% endfor %}
                                    {% endfor %}
                                </select>
                                </div>
                            <div class="form-group col-md-4 mb-3">{{ form.contact.label_tag }} {{ form.contact }}</div>
                        </div>

                        <div class="row">
                            <div class="form-group col-md-4 mb-3">{{ form.address.label_tag }} {{ form.address }}</div>
                            <div class="form-group col-md-4 mb-3">{{ form.location.label_tag }} {{ form.location }}</div>
                            <div class="form-group col-md-4 mb-3">{{ form.city.label_tag }} {{ form.city }}</div>
                        </div>
                        <div class="row">
                            <div class="form-group col-md-4 mb-3">{{ form.district.label_tag }} {{ form.district }}</div>
                            <div class="form-group col-md-4 mb-3">{{ form.state.label_tag }} {{ form.state }}</div>
                            <div class="form-group col-md-4 mb-3">{{ form.pincode.label_tag }} {{ form.pincode }}</div>
                        </div>
                        <div class="modal-footer">
                            <button type="submit" class="btn btn-primary">Save</button>
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>


    <!-- DataTales Example -->
    <div class="card shadow mb-4">
        <!-- add button + -->
        <button class="circle-btn" data-bs-toggle="modal" data-bs-target="#addUserModal">
            <i class="bi bi-plus-lg text-light"></i>
        </button>
        <div class="card-header py-3">
            <h6 class="m-0 font-weight-bold text-primary">DataTables Example</h6>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
                    <thead>
                        <tr>
                            <th>Full Name</th>
                            <th>Email</th>
                            <th>Gender</th>
                            <th>DOB</th>
                            <th>Address</th>
                            <th>location</th>
                            <th>city</th>
                            <th>district</th>
                            <th>state</th>
                            <th>pincode</th>
                            <th>perform actions</th>
                        </tr>
                    </thead>
                    {% for user in users %}
                    <tbody>
                        <tr>
                            <td>{{user.first_name}} {{user.last_name}}</td>
                            <td>{{user.email}}</td>
                            <td>{{user.gender}}</td>
                            <td>{{user.dob}}</td>
                            <td>{{user.address}}</td>
                            <td>{{user.location}}</td>
                            <td>{{user.city}}</td>
                            <td>{{user.diatrict}}</td>
                            <td>{{user.state}}</td>
                            <td>{{user.pincode}}</td>
                            <td>
                                <!-- Update Button -->
                                <a href="" class="text-primary edit-user-btn" data-id="{{ user.id }}" data-action-url="{% url 'manage_user_update' user.id %}">
                                    <i class="bi bi-pencil-square"></i>                           
                                </a>
                                
                                <!-- Delete Button -->
                                <form method="post" action="{% url 'manage_user_delete' user.id %}">
                                    {% csrf_token %}
                                    <button type="submit" class="btn text-danger">  
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </form>
                                <a href="#" class="text-primary">
                                    <i class="bi bi-eye-slash"></i>                                    
                                </a>
                            </td>
                        </tr>
                    </tbody>
                    {% endfor %}
                </table>
            </div>
        </div>
    </div>
</div>
<!-- Add Button -->
<button class="circle-btn" data-bs-toggle="modal" data-bs-target="#addUserModal">
    <i class="bi bi-plus-lg text-light"></i>
</button>
{% endblock %}
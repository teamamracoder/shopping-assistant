<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Signup</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    body { 
        background-color:#f8f9fa; 
        display:flex; 
        justify-content:center; 
        align-items:center; 
        height:100vh; 
        margin:0; 
    }
    .signup-container { 
        max-width:420px; 
        width:100%; 
        margin:80px auto; 
        padding:30px; 
        background:#ffffff; 
        border-radius:15px; 
        box-shadow:0 6px 20px rgba(0,0,0,0.08); 
    }
    .signup-title { 
        font-weight:600; 
        color:#333; 
        text-align:center; 
        margin-bottom:25px; 
        font-size:26px; 
    }
    .form-control { 
        border-radius:8px; 
    }
    .btn-submit { 
        width:100%; 
        background-color:#3399e6; 
        border:none; 
        border-radius:8px; 
        padding:10px; 
        font-size:16px; 
        font-weight:500; 
    }
    .btn-submit:hover { 
        background-color:#267ac2; 
    }
  </style>
</head>
<body>

  <div class="signup-container">
    <h4 class="signup-title">Signup</h4>

    <form id="signupForm">
      {% csrf_token %}
      <div class="mb-3">
        <input type="text" name="first_name" class="form-control" placeholder="First Name" required>
      </div>
      <div class="mb-3">
        <input type="text" name="last_name" class="form-control" placeholder="Last Name" required>
      </div>
      <div class="mb-3">
        <input type="email" name="email" class="form-control" placeholder="Email" required>
      </div>
      <div class="mb-3">
        <input type="text" name="phone" class="form-control" placeholder="Phone Number" required>
      </div>
      <button type="submit" class="btn btn-submit">Submit</button>
    </form>
    <div class="input-group text-center mt-1">
      <p>Already have an account</p><a href="/auth/login-page/" class="text-decoration-none ms-2"> SignIn</a>
    </div>
  </div>

  <!-- ✅ Load jQuery & Validation FIRST -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.5/dist/jquery.validate.min.js"></script>

  <!-- ✅ Initialize jQuery Validation -->
    <script>
        $(function () {
            $("#signupForm").validate({
                rules: {
                    first_name: { 
                        required: true, minlength: 2 
                    },
                    last_name: { 
                        required: true, minlength: 2 
                    },
                    email: { 
                        required: true, email: true 
                    },
                    phone: { 
                        required: true, 
                        digits: true, 
                        minlength: 10, 
                        maxlength: 10 
                    }
                },
                messages: {
                    first_name: { 
                        required: "First name is required", 
                        minlength: "At least 2 characters" 
                    },
                    last_name:  { 
                        required: "Last name is required", 
                        minlength: "At least 2 characters" 
                    },
                    email:      { 
                        required: "Email is required", 
                        email: "Enter a valid email address" 
                    },
                    phone:      { 
                        required: "Phone number is required", 
                        digits: "Only numbers allowed", 
                        minlength: "Must be 10 digits", 
                        maxlength: "Must be 10 digits" 
                    }
                },
                errorClass: "text-danger",
                errorElement: "small",
                highlight: function (el) { $(el).addClass("is-invalid"); },
                unhighlight: function (el) { $(el).removeClass("is-invalid"); }
            });
        });
    </script>

  <!-- ✅ Your submit code, but respect validation -->
    <script>
        document.getElementById("signupForm").addEventListener("submit", async function(e) {
        e.preventDefault();

        // Stop here if the form is invalid
        if (!$("#signupForm").valid()) return;

        let formData = new FormData(this);
        let payload = Object.fromEntries(formData.entries());

        let response = await fetch("{% url 'signup_api' %}", {
            method: "POST",
            headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": "{{ csrf_token }}"
            },
            body: JSON.stringify(payload)
        });

        let data = await response.json();
        if (response.ok) {
            Swal.fire({
            title: "Signup Successful!",
            text: "Your account has been created successfully.",
            icon: "success",
            confirmButtonText: "OK",
            confirmButtonColor: "#3399e6"
            }).then(() => {
            window.location.href = "{% url 'login_page' %}";
            });
        } else {
            Swal.fire({
            title: "Error",
            text: data.message || "Something went wrong!",
            icon: "error",
            confirmButtonText: "OK"
            });
        }
        });
    </script>

</body>
</html>
